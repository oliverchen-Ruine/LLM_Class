
## 定义
代码解释器这个名字是由 OpenAI 创造的， 指的是最近为 ChatGPT 开发的插件。代码解释器插件允许 ChatGPT 以各种编程语言编写和执行计算机代码。这使得 ChatGPT 可以执行计算、数据分析和生成可视化等任务。

代码解释器插件是专为语言模型设计的工具之一， 其核心原则是安全性。它可以帮助 ChatGPT 访问最新信息、运行计算或使用第三方服务。该插件目前处于私人测试阶段，仅面向部分开发人员和ChatGPTPlus用户开放。

虽然 OpenAI 的代码解释器仍未提供 API， 但一些开源项目已将该插件的概念改编为开源 Python 库。在本节中， 我们将利用 Shroominic 所做的工作， 该库位于 https://github.com/shroominic/codeinterpreter-api 。可以通过键入 ```pip install codeinterpreterapi``` 命令安装它。

根据代码解释器 API 的作者 Shroominic 发表的博文(网址为 https://blog.langchain.de/code-interpreter-api/ )， 可知它基于 LangChain 智能体 OpenAI Functions Agent来实现。

> **OpenAlFunctionsAgent**  
是一种可以使用 OpenAI 函数的智能体类型，它可以使用大规格语言模型来响应用户的提示。该智能体由一个支持使用 OpenAI 函数的模型驱动，可以访问一组工具，并用来与用户交互。
此外它还可以集成自定义函数。例如，可以定义自定义函数，使用雅虎财经获取当前股票价格或股票表现。OpenAlFunctionsAgent 可以使用 ReAct 框架来决定使用哪种工具，还可以使用记忆来记忆之前的会话交互。

API 已经配备了一些工具，例如，可以浏览 Web 以获取最新信息。

然而，与前一节中介绍的 Python REPL 工具最大的不同在于，代码解释器API可以实际执行自己生成的代码。事实上，当代码解释器会话启动时，借助名为 CodeBox 的底层 Python 执行环境，一个微型的 Jupyter 内核就会在设备上启动。
## 使用代码解释器 API
要开始在笔记中使用代码解释器，可以按如下步骤安装所有依赖项：

```bash
pip install "codeinterpreterapi[all]"
```

本例将要求它生成特定时间范围内 COVID- 19 病例对应的曲线图：
```python
from codeinterpreterapi import CodeInterpreterSession
import os
from dotenv import load_dotenv

load_dotenv()
api_key = os.environ['OPENAI_API_KEY']

# 创建会话
async with CodeInterpreterSession() as session:
    # 根据用户输入生成响应
    response = await session.generate_response(
        "Generate a plot of the evolution of Covid-19 from March to June 2020, taking data from web."
        )
    # 输出响应
    print("AI:", response.content)
    for file in response.files:    
        file.show_image()
```
下图是生成的输出结果，包括一张显示指定时间段内全球确诊病例数的图表。

>AI: Here is the plot showing the evolution of global daily confirmed COVID-19 cases from March to June 2020. As you can see, the number of cases has been increasing over time during this period. Please note that these numbers are cumulative. Each point on the graph represents the total number of confirmed cases up to that date, not just the new cases on that day.
<p align="center">
<img src="/img/7.1.png" width="800"/>
</p>
<p align="center">
<br>代码解释器API生成的折线图</br>
</p>

如上所示，代码解释器回答了问题，并给出了解释且生成了图表。

## 实时搜索最新信息的功能
在下面的代码段中，要求模型绘制标准普尔500指数过去5天的价格图:

```python
async with CodeInterpreterSession() as session:
    # 根据用户输入生成响应
    response = await session.generate_response(
        "Generate a plot of the price of S&P500 index in the last 5 days."
    )
    # 输出响应
    print("AI:"， response.content)
    for file in response.files:
        file.show_image()
```

之后可以得到如下所示的输出结果，以及显示标准普尔500指数过去5天价格的折线图:

>AT: Here is the plot of the S&P 500 index for the last 5 days, The y-axis represents the closing price of the index, and the x-axis represents the date.

<p align="center">
<img src="/img/7.2.png" width="800"/>
</p>
<p align="center">
<br>标准普尔500指数前5天的价格</br>
</p>

## 本地数据调用

最后，可以向代码解释器提供本地数据，以便它对特定数据进行分析。例如，从Kaggle下载了Titanic(泰坦尼克号)数据集，网址为https://www.kaggle.com/datasets/brendan45774/test-file 。泰坦尼克号数据集是用于机器学习的热门数据集，描述了泰坦尼克号上乘客的生存状况。它包含年龄、性别、舱位、票价以及是否幸存等信息。
数据集下载完毕后，将其保存在 Google Drive 中，然后将其作为参数传递给代码解释器会话，如下所示: 我将其作为参数传递给模型， 如下所示:

```python
from codeinterpreterapi import CodeInterpreterSession,File

os.environ['OPENAI_API_KEY'] = "sk-****"

os.environ['VERBOSE'] = "True"

async with CodeInterpreterSession() as session:
    # 定义用户请求 
    user_request = "Analyze this dataset and plot something interesting about it."
    files = [ File.from_path("drive/MyDrive/titanic.csv"), ]
    # 生成响应
    response = await session.generate_response(user_request, files=files)
    # 输出给用户
    print("AI:", response.content)
    for file in response.files:
        file.show_image()
```
然后，得到如下输出：

>AI: The plot shows the survival count based on the passenger class. It appears that passengers in the 3rd class had a significantly lower survival rate compared to those in the 1st and 2nd classes. This could suggest that the class of the passengers might have influenced their survival， possibly due to factors such as the location of their cabins and access to lifeboats.  
These are just a few examples of the kind of insights we can extract from this dataset. Depending on the specific questions you're interested in， we could perform further analysis. For example， we could look at the survival rate based on age， or investigate whether the fare passengers paid had any influence on their survival.

<p align="center">
<img src="/img/7.3.png" width="800"/>
</p>
<p align="center">
<br>按性别分组的生存状态(上)和按类别分组的生存状态(下)</br>
</p>

代码解释器插件、代码专用大规模语言模型和Python智能体都是大规模语言模型对软件开发领域产生巨大影响的绝佳例子。这可以概括为以下两大功能:

- **理解并生成代码**，原因是其已经在大量编程语言、GitHub仓库、StackOverflow 会话等方面接受过训练。因此, 与自然语言一样, 编程语言也是其参数知识的一部分。
- **理解用户的意图**，并作为推理引擎激活 Python REPL 或 Code Interpreter 等工具, 然后通过处理代码来提供响应。

总体而言, 大规模语言模型远远超出了消除自然语言和机器语言之间差距的范畴: 相反, 大规模语言模型正在将二者整合在一起, 使它们能够相互利用, 以响应用户的询问。